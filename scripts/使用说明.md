# Wiktionary 数据导入使用说明

## 快速开始

### 1. 安装 Python 依赖

```bash
cd scripts
pip install -r requirements.txt
```

### 2. 抓取数据

```bash
# 抓取 A1 级别 50 个单词
python fetch_wiktionary.py --level A1 --count 50 --output data/wiktionary_raw_A1.json

# 抓取 A2 级别 50 个单词
python fetch_wiktionary.py --level A2 --count 50 --output data/wiktionary_raw_A2.json
```

### 3. 转换数据格式

```bash
# 转换 A1 数据
python transform_data.py --input data/wiktionary_raw_A1.json --output data/wiktionary_words_A1.json --validate

# 转换 A2 数据
python transform_data.py --input data/wiktionary_raw_A2.json --output data/wiktionary_words_A2.json --validate
```

### 4. 转换为小程序模块

```bash
# 将 JSON 转换为 JS 模块
node import_to_miniprogram.js data/wiktionary_words_A1.json
```

这会在 `data/` 目录下生成 `wiktionary_words_A1.js` 文件。

### 5. 导入到小程序

#### 方法一：在小程序中直接导入（推荐）

在小程序中添加导入功能：

```javascript
// pages/index/index.js
const { words } = require('../../data/wiktionary_words_A1.js');

// 调用云函数导入
wx.cloud.callFunction({
  name: 'importWiktionary',
  data: {
    words: words,
    level: 'A1'
  }
}).then(res => {
  console.log('导入结果:', res.result);
});
```

#### 方法二：通过小程序界面导入

1. 在小程序首页点击"导入 Wiktionary 数据"
2. 选择要导入的级别（A1-C2）
3. 系统会自动读取对应级别的数据文件并导入

#### 方法三：直接调用云函数

```javascript
wx.cloud.callFunction({
  name: 'importWiktionary',
  data: {
    words: [...], // 单词数组
    level: 'A1'
  }
})
```

## 注意事项

### 1. 翻译问题

当前 `transform_data.py` 中的翻译功能是简化版本，只包含少量关键词映射。实际使用时建议：

- **方案 A**: 集成翻译 API（如 Google Translate API、百度翻译 API）
- **方案 B**: 使用预翻译的词库
- **方案 C**: 手动审核和补充翻译

### 2. 级别判断

当前脚本使用预定义的常用词列表。更准确的方式：

- 使用 CEFR 词频数据
- 参考意大利语学习标准词表
- 手动标注级别

### 3. 选项生成

当前使用随机干扰选项。可以改进：

- 使用同义词/近义词作为干扰项
- 根据词性生成更相关的干扰项
- 使用机器学习模型生成更自然的干扰项

### 4. 数据验证

建议在导入前：

- 检查所有必需字段是否存在
- 验证音标格式
- 检查例句是否合理
- 确保选项数量正确

## 批量导入流程

```bash
# 1. 批量抓取所有级别
for level in A1 A2 B1 B2 C1 C2; do
  python fetch_wiktionary.py --level $level --count 100 --output data/wiktionary_raw_${level}.json
  sleep 60  # 避免请求过快
done

# 2. 批量转换
for level in A1 A2 B1 B2 C1 C2; do
  python transform_data.py --input data/wiktionary_raw_${level}.json --output data/wiktionary_words_${level}.json --validate
done

# 3. 在小程序中逐个导入
```

## 故障排除

### 问题 1: 请求被限制

**解决方案**: 增加 `--delay` 参数，降低请求频率
```bash
python fetch_wiktionary.py --level A1 --count 50 --delay 1.0
```

### 问题 2: 翻译不准确

**解决方案**: 
- 使用翻译 API 替换 `translate_meaning()` 函数
- 或手动审核和编辑 JSON 文件

### 问题 3: 数据不完整

**解决方案**: 
- 使用 `--validate` 参数验证数据
- 检查 Wiktionary 是否有该单词的完整数据
- 手动补充缺失字段

## 扩展建议

1. **添加音频**: 从 Wiktionary 或其他来源获取单词发音音频
2. **添加图片**: 为名词类单词添加配图
3. **词频数据**: 集成词频数据，自动判断单词级别
4. **例句丰富**: 为每个单词添加多个例句
5. **词根分析**: 添加词根、词缀信息，帮助记忆

